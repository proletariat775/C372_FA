<%#
I declare that this code was written by me.
I will not copy or allow others to copy my code.
I understand that copying code is considered as plagiarism.

Student Name: Wendy Liew Wen Ying
Student ID: 24038281
Class: C372-002
Date created: 06/02/2026
%>

<%- include('partials/header', { title: 'EcoPoints Directory | Shirt Shop' }) %>
  <%- include('partials/adminNavbar', { user: typeof user !=='undefined' ? user : null }) %>
  <style>
    .admin-loyalty-card {
      max-width: 980px;
    }

    .loyalty-adjust-form {
      display: grid;
      grid-template-columns: minmax(130px, 150px) minmax(180px, 1fr) auto;
      gap: 0.5rem;
      align-items: center;
    }

    .loyalty-adjust-form .form-control {
      color: #111827 !important;
      min-width: 0;
    }

    .loyalty-adjust-form .btn {
      white-space: nowrap;
    }

    @media (max-width: 991.98px) {
      .loyalty-adjust-form {
        grid-template-columns: 1fr;
      }
    }
  </style>

    <section class="page-section">
      <div class="container">
        <div class="form-card admin-loyalty-card">
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-3">
            <div>
              <h1 class="mb-1">EcoPoints directory</h1>
              <p class="text-muted mb-0">Adjust customer EcoPoints with a positive or negative value.</p>
            </div>
            <div class="d-flex flex-column align-items-md-end">
              <span class="badge bg-secondary fs-6">Customers: <%= customers ? customers.length : 0 %></span>
              <small class="text-muted mt-1">Total EcoPoints in circulation: <%= Number(totalPoints || 0) %></small>
              <small class="text-muted">Total EcoPoints issued: <%= Number(totalIssuedPoints || 0) %></small>
            </div>
          </div>

          <% if (errors && errors.length) { %>
            <% errors.forEach(function(error) { %>
              <div class="alert alert-danger">
                <%= error %>
              </div>
              <% }); %>
                <% } %>

                  <% if (messages && messages.length) { %>
                    <% messages.forEach(function(message) { %>
                      <div class="alert alert-success">
                        <%= message %>
                      </div>
                      <% }); %>
                        <% } %>

                          <% if (!customers || customers.length===0) { %>
                            <div class="alert alert-light border mb-0">No customer accounts found.</div>
                            <% } else { %>
                              <div class="table-responsive">
                                <table class="table align-middle">
                                  <thead>
                                    <tr>
                                      <th scope="col">Customer</th>
                                      <th scope="col">Email</th>
                                      <th scope="col">Current EcoPoints</th>
                                      <th scope="col">Adjust EcoPoints</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <% customers.forEach(function(customer) { %>
                                      <tr>
                                        <td>
                                          <strong>
                                            <%= customer.username %>
                                          </strong>
                                          <div class="text-muted small">
                                            <%= customer.first_name || '' %>
                                              <%= customer.last_name || '' %>
                                          </div>
                                        </td>
                                        <td>
                                          <%= customer.email %>
                                        </td>                                        <td>
                                          <span class="badge bg-primary-subtle text-primary fs-6">
                                            <%= Number(customer.loyalty_points || 0) %> pts
                                          </span>
                                        </td>
                                        <td>
                                          <form action="/admin/loyalty/<%= customer.id %>/adjust" method="POST" class="loyalty-adjust-form">
                                            <input type="number" name="pointsChange" class="form-control form-control-sm text-dark" step="1" placeholder="+50 or -25" required>
                                            <input type="text" name="note" class="form-control form-control-sm text-dark" placeholder="Reason (optional)" maxlength="60">
                                            <button type="submit" class="btn btn-primary btn-sm">Apply</button>
                                          </form>
                                        </td>
                                      </tr>
                                      <% }); %>
                                  </tbody>
                                </table>
                              </div>
                              <% } %>
        </div>
      </div>
    </section>

    <%- include('partials/footer') %>





<%- include('partials/header', { title: 'EcoPoints Directory | Shirt Shop' }) %>
  <%- include('partials/adminNavbar', { user: typeof user !=='undefined' ? user : null }) %>

    <section class="page-section">
      <div class="container">
        <div class="form-card">
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-3">
            <div>
              <h1 class="mb-1">EcoPoints directory</h1>
              <p class="text-muted mb-0">Read-only view of customer EcoPoints activity.</p>
            </div>
            <div class="d-flex flex-column align-items-md-end">
              <span class="badge bg-secondary fs-6">Customers: <%= customers ? customers.length : 0 %></span>
              <small class="text-muted mt-1">Total EcoPoints in circulation: <%= Number(totalPoints || 0) %></small>
              <small class="text-muted">Total EcoPoints issued: <%= Number(totalIssuedPoints || 0) %></small>
            </div>
          </div>

          <% if (errors && errors.length) { %>
            <% errors.forEach(function(error) { %>
              <div class="alert alert-danger">
                <%= error %>
              </div>
              <% }); %>
                <% } %>

                  <% if (messages && messages.length) { %>
                    <% messages.forEach(function(message) { %>
                      <div class="alert alert-success">
                        <%= message %>
                      </div>
                      <% }); %>
                        <% } %>

                          <% if (!customers || customers.length===0) { %>
                            <div class="alert alert-light border mb-0">No customer accounts found.</div>
                            <% } else { %>
                              <div class="table-responsive">
                                <table class="table align-middle">
                                  <thead>
                                    <tr>
                                      <th scope="col">Customer</th>
                                      <th scope="col">Email</th>
                                      <th scope="col">Current EcoPoints</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <% customers.forEach(function(customer) { %>
                                      <tr>
                                        <td>
                                          <strong>
                                            <%= customer.username %>
                                          </strong>
                                          <div class="text-muted small">
                                            <%= customer.first_name || '' %>
                                              <%= customer.last_name || '' %>
                                          </div>
                                        </td>
                                        <td>
                                          <%= customer.email %>
                                        </td>
                                        <td>
                                          <span class="badge bg-primary-subtle text-primary fs-6">
                                            <%= Number(customer.loyalty_points || 0) %> pts
                                          </span>
                                        </td>
                                      </tr>
                                      <% }); %>
                                  </tbody>
                                </table>
                              </div>
                              <% } %>
        </div>
      </div>
    </section>

    <%- include('partials/footer') %>

<%#
I declare that this code was written by me.
I will not copy or allow others to copy my code.
Student Name: Zhang KaiXiang
Student ID: 24041976
Class: C372-002
Date created: 06/02/2026
%>

<%- include('partials/header', { title: 'Edit User | Shirt Shop' }) %>
  <%- include('partials/adminNavbar', { user: typeof user !=='undefined' ? user : null }) %>

    <section class="page-section">
      <div class="container">
        <div class="form-card">
          <div
            class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 mb-3">
            <div>
              <h1 class="mb-1">Customer details</h1>
              <p class="text-muted mb-0">Update account access, role, and password.</p>
            </div>
            <a href="/admin/users" class="btn btn-outline-secondary">Back to users</a>
          </div>

          <% if (errors && errors.length) { %>
            <% errors.forEach(function(error) { %>
              <div class="alert alert-danger">
                <%= error %>
              </div>
              <% }); %>
                <% } %>

                  <% if (messages && messages.length) { %>
                    <% messages.forEach(function(message) { %>
                      <div class="alert alert-success">
                        <%= message %>
                      </div>
                      <% }); %>
                        <% } %>

                          <div class="row g-3">
                            <div class="col-12 col-lg-6">
                              <div class="p-3 bg-light rounded h-100">
                                <h5 class="mb-2">
                                  <%= managedUser.username %>
                                </h5>
                                <div class="text-muted">
                                  <%= managedUser.first_name || '' %>
                                    <%= managedUser.last_name || '' %>
                                </div>
                                <div class="mt-2"><strong>Email:</strong>
                                  <%= managedUser.email %>
                                </div>
                                <div><strong>Phone:</strong>
                                  <%= managedUser.phone || 'Not provided' %>
                                </div>
                              </div>
                            </div>
                            <div class="col-12 col-lg-6">
                              <div class="p-3 bg-light rounded h-100">
                                <div class="mb-2"><strong>Address:</strong></div>
                                <div>
                                  <%= managedUser.address || 'Not provided' %>
                                </div>
                              </div>
                            </div>

                            <div class="col-12">
                              <form action="/admin/users/<%= managedUser.id %>" method="POST" class="row g-3">
                                <div class="col-12 col-md-6">
                                  <label class="form-label">Username</label>
                                  <input type="text" class="form-control" name="username" required
                                    value="<%= managedUser.username %>">
                                </div>
                                <div class="col-12 col-md-6">
                                  <label class="form-label">Email</label>
                                  <input type="email" class="form-control" name="email" required
                                    value="<%= managedUser.email %>">
                                </div>
                                <div class="col-12 col-md-6">
                                  <label class="form-label">First name</label>
                                  <input type="text" class="form-control" name="first_name"
                                    value="<%= managedUser.first_name || '' %>">
                                </div>
                                <div class="col-12 col-md-6">
                                  <label class="form-label">Last name</label>
                                  <input type="text" class="form-control" name="last_name"
                                    value="<%= managedUser.last_name || '' %>">
                                </div>
                                <div class="col-12 col-md-6">
                                  <label class="form-label">Phone</label>
                                  <input type="text" class="form-control" name="phone"
                                    value="<%= managedUser.phone || '' %>">
                                </div>
                                <div class="col-12 col-md-6">
                                  <label class="form-label">Address</label>
                                  <input type="text" class="form-control" name="address"
                                    value="<%= managedUser.address || '' %>">
                                </div>
                                <div class="col-12 col-md-4">
                                  <label class="form-label">City</label>
                                  <input type="text" class="form-control" name="city"
                                    value="<%= managedUser.city || '' %>">
                                </div>
                                <div class="col-12 col-md-4">
                                  <label class="form-label">State</label>
                                  <input type="text" class="form-control" name="state"
                                    value="<%= managedUser.state || '' %>">
                                </div>
                                <div class="col-12 col-md-4">
                                  <label class="form-label">Zip code</label>
                                  <input type="text" class="form-control" name="zip_code"
                                    value="<%= managedUser.zip_code || '' %>">
                                </div>
                                <div class="col-12">
                                  <label class="form-label">Country</label>
                                  <input type="text" class="form-control" name="country"
                                    value="<%= managedUser.country || '' %>">
                                </div>
                                <div class="col-12 col-md-6">
                                  <label class="form-label">Role</label>
                                  <select class="form-select" name="role" required>
                                    <option value="customer" <%=managedUser.role==='customer' ? 'selected' : '' %>
                                      >Customer</option>
                                    <option value="admin" <%=managedUser.role==='admin' ? 'selected' : '' %>>Admin
                                    </option>
                                  </select>
                                </div>
                                <div class="col-12 col-md-6">
                                  <label class="form-label">Account status</label>
                                  <select class="form-select" name="activate">
                                    <option value="1" <%=managedUser.activate===1 ? 'selected' : '' %>>Active</option>
                                    <option value="0" <%=managedUser.activate===0 ? 'selected' : '' %>>Inactive</option>
                                  </select>
                                </div>
                                <div class="col-12">
                                  <label class="form-label">New password (optional)</label>
                                  <input type="password" class="form-control" name="password" minlength="6"
                                    placeholder="Leave blank to keep current password">
                                  <div class="form-text">Minimum 6 characters.</div>
                                </div>
                                <div class="col-12 d-flex flex-wrap gap-2">
                                  <button type="submit" class="btn btn-primary">Save changes</button>
                                  <a href="/admin/deliveries?userId=<%= managedUser.id %>"
                                    class="btn btn-outline-primary">View customer orders</a>
                                </div>
                              </form>
                            </div>
                          </div>
        </div>
      </div>
    </section>

    <%- include('partials/footer') %>
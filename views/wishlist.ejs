<%- include('partials/header', { title: 'Wishlist | Shirt Shop' }) %>
  <%- include('partials/navbar', { user: typeof user !=='undefined' ? user : null }) %>

    <main class="page-section">
      <div class="container">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-4">
          <div>
            <p class="mb-1 text-muted">Saved items</p>
            <h2 class="mb-0">Your wishlist</h2>
          </div>
          <a href="/shopping" class="btn btn-primary">Continue shopping</a>
        </div>

        <% if (messages && messages.length) { %>
          <% messages.forEach(function(message) { %>
            <div class="alert alert-success">
              <%= message %>
            </div>
            <% }); %>
              <% } %>

                <% if (errors && errors.length) { %>
                  <% errors.forEach(function(error) { %>
                    <div class="alert alert-danger">
                      <%= error %>
                    </div>
                    <% }); %>
                      <% } %>

                        <% if (items && items.length) { %>
                          <div class="row g-4">
                            <% items.forEach(function(item) { %>
                              <div class="col-12 col-md-6 col-lg-4">
                                <div class="card h-100 shadow-sm">
                                  <% if (item.image) { %>
                                    <img src="/images/<%= item.image %>" class="card-img-top"
                                      alt="<%= item.productName %>">
                                    <% } else { %>
                                      <div
                                        class="card-img-top bg-light d-flex align-items-center justify-content-center"
                                        style="height: 200px;">
                                        <span class="text-muted">No image yet</span>
                                      </div>
                                      <% } %>
                                        <div class="card-body d-flex flex-column">
                                          <h5 class="card-title">
                                            <a href="/product/<%= item.product_id %>"
                                              class="text-decoration-none text-dark">
                                              <%= item.productName %>
                                            </a>
                                          </h5>
                                          <% if (item.hasDiscount) { %>
                                            <div class="d-flex flex-column mb-2">
                                              <span class="text-muted text-decoration-line-through small">$<%=
                                                  Number(item.price).toFixed(2) %></span>
                                              <span class="fw-semibold text-success">$<%=
                                                  Number(item.effectivePrice).toFixed(2) %></span>
                                              <span class="badge bg-success-subtle text-success align-self-start mt-1">
                                                <%= Number(item.discountPercentage).toFixed(2) %>% off
                                              </span>
                                            </div>
                                            <% } else { %>
                                              <div class="fw-semibold mb-2">$<%= Number(item.price).toFixed(2) %>
                                              </div>
                                              <% } %>
                                                <% if (item.offerMessage) { %>
                                                  <p class="text-muted small mb-3">
                                                    <%= item.offerMessage %>
                                                  </p>
                                                  <% } %>

                                                    <form action="/wishlist/<%= item.product_id %>/remove" method="POST"
                                                      class="mt-auto">
                                                      <button type="submit"
                                                        class="btn btn-outline-danger w-100">Remove</button>
                                                    </form>
                                        </div>
                                </div>
                              </div>
                              <% }); %>
                          </div>
                          <% } else { %>
                            <div class="empty-state">
                              <h3>Your wishlist is empty</h3>
                              <p class="text-muted">Save items for later and track your favorites here.</p>
                              <a href="/shopping" class="btn btn-primary">Browse products</a>
                            </div>
                            <% } %>
      </div>
    </main>
    <%- include('partials/footer') %>
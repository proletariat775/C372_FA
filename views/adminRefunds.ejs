<%#
I declare that this code was written by me.
I will not copy or allow others to copy my code.
I understand that copying code is considered as plagiarism.

Student Name: Zoey Liaw En Yi
Student ID: 24049473
Class: C372_002_E63C
Date created: 06/02/2026
%>

<%- include('partials/header', { title: 'Refund Requests | Shirt Shop' }) %>
<%- include('partials/adminNavbar', { user: typeof user !== 'undefined' ? user : null }) %>

<main class="page-section">
  <div class="container">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-4">
      <div>
        <p class="mb-1 text-muted">Admin</p>
        <h2 class="mb-0">Refund requests</h2>
      </div>
      <a href="/admin/deliveries" class="btn btn-outline-secondary">Back to admin</a>
    </div>

    <% if (messages && messages.length) { %>
      <% messages.forEach(function(message) { %>
        <div class="alert alert-success"><%= message %></div>
      <% }); %>
    <% } %>

    <% if (errors && errors.length) { %>
      <% errors.forEach(function(error) { %>
        <div class="alert alert-danger"><%= error %></div>
      <% }); %>
    <% } %>

    <% if (!requests || requests.length === 0) { %>
      <div class="empty-state">
        <h3>No refund requests</h3>
        <p class="text-muted">Refund requests submitted by users will appear here.</p>
      </div>
    <% } else { %>
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>Request</th>
              <th>Order</th>
              <th>User</th>
              <th>Amount</th>
              <th>Approved</th>
              <th>Status</th>
              <th>Submitted</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <% requests.forEach(function(request) { %>
              <tr>
                <td class="fw-semibold">#<%= request.id %></td>
                <td>
                  <%= request.orderNumber ? `Order #${request.orderNumber} (ID: ${request.orderId})` : `Order #${request.orderId}` %>
                </td>
                <td>
                  <div><%= request.username %></div>
                  <div class="text-muted small"><%= request.email %></div>
                </td>
                <td>$<%= Number(request.requestedAmount || 0).toFixed(2) %></td>
                <td><%= request.approvedAmount ? '$' + Number(request.approvedAmount || 0).toFixed(2) : '-' %></td>
                <td><span class="badge bg-light text-dark border"><%= (request.status || 'UNKNOWN').toUpperCase() %></span></td>
                <td><%= request.createdAt ? new Date(request.createdAt).toLocaleString() : '-' %></td>
                <td>
                  <a href="/admin/refunds/<%= request.id %>" class="btn btn-sm btn-outline-primary">View</a>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>
</main>

<%- include('partials/footer') %>
